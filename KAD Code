<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOBE Weather Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: radial-gradient(circle at center, #2c5364, #203a43, #0f2027);
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #ffffff;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            width: 625px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            padding-bottom: 8px;
        }

        .main-title { font-size: 1.1rem; font-weight: bold; margin: 0; }
        .current-date { font-size: 1.1rem; font-weight: 300; color: rgba(255, 255, 255, 0.8); }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 300px;
            grid-template-rows: 140px 140px;
            gap: 25px;
        }

        .panel {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .chart-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; opacity: 0.4;
        }

        .data-group { position: relative; z-index: 2; text-align: center; }
        .label { font-size: 0.7rem; color: #a0c4ff; font-weight: bold; margin-bottom: 5px; }
        .flex-row { display: flex; align-items: center; justify-content: center; }
        .value { font-size: 3rem; font-weight: 200; line-height: 1.1; }
        .sub-value { font-size: 2rem; font-weight: 200; line-height: 1.1; }
        .unit { font-size: 0.85rem; margin-left: 5px; }

        .temp { color: #ffab91; }
        .rain { color: #81d4fa; }
        .wind { color: #a5d6a7; }

        #update-msg {
            position: absolute; bottom: 20px; font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>
<body>

<div class="header-container">
    <h1 class="main-title">„Ç¢„É°„ÉÄ„Çπ ÂÖµÂ∫´ÁúåÁ•ûÊà∏Ë¶≥Ê∏¨„Éá„Éº„Çø</h1>
    <div class="current-date" id="today-date">----/--/--</div>
</div>

<div class="dashboard">
    <div class="panel">
        <canvas id="tempChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">TEMPERATURE</div>
            <div class="flex-row temp">
                <span style="font-size: 1.8rem; margin-right:8px;">üå°Ô∏è</span>
                <div class="value"><span id="temp-val">--</span><span class="unit">‚ÑÉ</span></div>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="data-group">
            <div class="label">LAST UPDATE</div>
            <div class="value" id="time-val" style="font-size: 3.5rem;">--:--</div>
        </div>
    </div>

    <div class="panel">
        <canvas id="rainChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">PRECIPITATION</div>
            <div class="flex-row rain">
                <span style="font-size: 1.2rem; margin-right: 6px;">üíß</span>
                <div class="sub-value"><span id="rain-val">--</span><span class="unit">mm</span></div>
            </div>
        </div>
    </div>

    <div class="panel">
        <canvas id="windChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">WIND SPEED</div>
            <div class="flex-row wind">
                <div class="value"><span id="wind-val">--</span><span class="unit">m/s</span></div>
            </div>
        </div>
    </div>
</div>

<div id="update-msg">Loading reliable weather data...</div>

<script>
    let charts = {};

    function initCharts(tempHistory, rainHistory, windHistory) {
        const configs = [
            { id: 'tempChart', color: '#ffab91', data: tempHistory },
            { id: 'rainChart', color: '#81d4fa', data: rainHistory },
            { id: 'windChart', color: '#a5d6a7', data: windHistory }
        ];

        configs.forEach(config => {
            const ctx = document.getElementById(config.id);
            charts[config.id] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(config.data.length).fill(''),
                    datasets: [{
                        data: config.data,
                        borderColor: config.color,
                        backgroundColor: config.color + '33',
                        fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        });
    }

    async function updateData() {
        const msgEl = document.getElementById('update-msg');
        // Á•ûÊà∏„ÅÆÁ∑ØÂ∫¶ÁµåÂ∫¶
        const lat = 34.69;
        const lon = 135.19;
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,precipitation,wind_speed_10m&hourly=temperature_2m,precipitation,wind_speed_10m&timezone=Asia%2FTokyo`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            // ÁèæÂú®„ÅÆ„Éá„Éº„Çø
            const current = data.current;
            document.getElementById('temp-val').innerText = current.temperature_2m.toFixed(1);
            document.getElementById('rain-val').innerText = current.precipitation.toFixed(1);
            document.getElementById('wind-val').innerText = (current.wind_speed_10m / 3.6).toFixed(1); // km/h -> m/sÂ§âÊèõ

            // Êó•ÊôÇ
            const now = new Date();
            document.getElementById('today-date').innerText = now.toLocaleDateString();
            document.getElementById('time-val').innerText = now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');

            // ÈÅéÂéª24ÊôÇÈñì„ÅÆÂ±•Ê≠¥„Éá„Éº„Çø„Çí„Ç∞„É©„Éï„Å´ÈÅ©Áî®
            const historyLimit = 24;
            const tempH = data.hourly.temperature_2m.slice(0, historyLimit);
            const rainH = data.hourly.precipitation.slice(0, historyLimit);
            const windH = data.hourly.wind_speed_10m.slice(0, historyLimit).map(v => v / 3.6);

            if (!charts.tempChart) {
                initCharts(tempH, rainH, windH);
            } else {
                charts.tempChart.data.datasets[0].data = tempH;
                charts.rainChart.data.datasets[0].data = rainH;
                charts.windChart.data.datasets[0].data = windH;
                Object.values(charts).forEach(c => c.update());
            }

            msgEl.innerText = "System Online: Data provided by Open-Meteo";
        } catch (e) {
            msgEl.innerText = "Connection Error. Retrying...";
            console.error(e);
        }
    }

    window.onload = () => {
        updateData();
        setInterval(updateData, 600000);
    };
</script>
</body>
</html>
