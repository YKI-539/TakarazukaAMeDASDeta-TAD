<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…µåº«çœŒå®å¡šå¸‚ æ°—è±¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
            background: radial-gradient(circle at center, #2c5364, #203a43, #0f2027) fixed;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #ffffff;
            padding: 40px 0;
            overflow-y: auto;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            width: 625px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            padding-bottom: 10px;
        }

        .main-title { font-size: 1.2rem; font-weight: bold; margin: 0; letter-spacing: 0.05em; }
        
        .current-info { 
            font-size: 1.1rem; 
            font-weight: 300; 
            color: rgba(255, 255, 255, 0.85); 
            display: flex; 
            gap: 12px;
            align-items: center;
        }
        .update-label { font-size: 0.9rem; opacity: 0.7; margin-right: -5px; }

        .section-label {
            width: 625px;
            font-size: 1.1rem;
            color: #a0c4ff;
            margin-bottom: 18px;
            letter-spacing: 0.12em;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(160, 196, 255, 0.5);
            border-left: 4px solid #a0c4ff;
            padding-left: 12px;
        }

        /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
        .dashboard {
            display: grid;
            grid-template-columns: 300px 300px;
            gap: 25px;
            margin-bottom: 25px;
        }

        /* æ°—åœ§ãƒ‘ãƒãƒ«å°‚ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠï¼ˆä¸­å¤®é…ç½®ï¼‰ */
        .pressure-container {
            width: 625px;
            height: 150px;
            margin-bottom: 45px;
        }

        .forecast-container {
            display: grid;
            grid-template-columns: 300px 300px;
            gap: 25px;
            width: 625px;
            margin-bottom: 40px;
        }

        .panel {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.12);
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        .chart-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; opacity: 0.25;
        }

        .data-group { position: relative; z-index: 2; text-align: center; width: 100%; }
        .label { font-size: 0.8rem; color: #a0c4ff; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; text-shadow: 0 0 4px rgba(160, 196, 255, 0.3); }
        .flex-row { display: flex; align-items: center; justify-content: center; }
        
        .value { 
            font-size: 4rem; font-weight: 600; line-height: 1; letter-spacing: -0.02em;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
        .current-weather-text { 
            font-size: 3.2rem; font-weight: 600; line-height: 1; color: #fff;
            text-shadow: 0 0 12px rgba(255, 255, 255, 0.3);
        }
        .sub-value { 
            font-size: 2.5rem; font-weight: 600; line-height: 1;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.15);
        }
        .unit { font-size: 1rem; margin-left: 6px; font-weight: bold; vertical-align: bottom; }

        .forecast-text { font-size: 1.8rem; font-weight: bold; color: #fff; margin-top: 4px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.2); }
        .high { color: #ffab91; font-weight: bold; text-shadow: 0 0 6px rgba(255, 171, 145, 0.3); }
        .low { color: #81d4fa; font-weight: bold; text-shadow: 0 0 6px rgba(129, 212, 250, 0.3); }

        #update-msg { font-size: 0.8rem; color: rgba(255, 255, 255, 0.4); margin-bottom: 40px; }
    </style>
</head>
<body>

<div class="header-container">
    <h1 class="main-title">ğŸ“ å…µåº«çœŒ å®å¡šå¸‚ æ°—è±¡å®Ÿæ³</h1>
    <div class="current-info">
        <span class="update-label">æœ€çµ‚æ›´æ–°:</span>
        <span id="today-date">----å¹´--æœˆ--æ—¥</span>
        <span id="time-val">--:--</span>
    </div>
</div>

<div class="section-label">ç¾åœ¨ã®è¦³æ¸¬çŠ¶æ³ï¼ˆå®å¡šå¸‚ä»˜è¿‘ï¼‰</div>

<div class="dashboard">
    <div class="panel">
        <canvas id="tempChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">ç¾åœ¨ã®æ°—æ¸©</div>
            <div class="flex-row" style="color: #ffab91; text-shadow: 0 0 12px rgba(255, 171, 145, 0.3);">
                <span style="font-size: 2rem; margin-right:8px;">ğŸŒ¡ï¸</span>
                <div class="value"><span id="temp-val">--</span><span class="unit">â„ƒ</span></div>
            </div>
        </div>
    </div>

    <div class="panel" style="background: rgba(255, 255, 255, 0.1);">
        <div class="data-group">
            <div class="label">ç¾åœ¨ã®å¤©æ°—</div>
            <div id="current-weather" class="current-weather-text">--</div>
        </div>
    </div>

    <div class="panel">
        <canvas id="rainSnowChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">é™æ°´ / é™é›ª</div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <div class="flex-row" style="color: #81d4fa; text-shadow: 0 0 10px rgba(129, 212, 250, 0.3);">
                    <span style="font-size: 1.5rem; margin-right: 10px;">â˜‚ï¸</span>
                    <div class="sub-value"><span id="rain-val">--</span><span class="unit">mm</span></div>
                </div>
                <div class="flex-row" style="color: #ffffff;">
                    <span style="font-size: 1.5rem; margin-right: 10px;">ğŸŒ¨ï¸</span>
                    <div class="sub-value"><span id="snow-val">--</span><span class="unit">cm</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel">
        <canvas id="windChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">é¢¨é€Ÿ / é¢¨å‘</div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <div class="flex-row" style="color: #a5d6a7; text-shadow: 0 0 10px rgba(165, 214, 167, 0.3);">
                    <div class="sub-value"><span id="wind-val">--</span><span class="unit">m/s</span></div>
                </div>
                <div class="flex-row" style="color: #fff176; font-size: 1.5rem; font-weight: bold;">
                    <span id="wind-dir-val">--</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="pressure-container">
    <div class="panel">
        <canvas id="pressureChart" class="chart-overlay"></canvas>
        <div class="data-group">
            <div class="label">ç¾åœ¨ã®æ°—åœ§</div>
            <div class="flex-row" style="color: #ce93d8; text-shadow: 0 0 12px rgba(206, 147, 216, 0.3);">
                <span style="font-size: 1.8rem; margin-right: 10px;">â²ï¸</span>
                <div class="value"><span id="pressure-val">--</span><span class="unit">hPa</span></div>
            </div>
        </div>
    </div>
</div>

<div class="section-label">å®å¡šå¸‚ã®å¤©æ°—äºˆå ±</div>

<div class="forecast-container">
    <div class="panel" style="height: 160px;">
        <div class="data-group">
            <div class="label">ä»Šæ—¥ã®å¤©æ°—</div>
            <div id="today-weather" class="forecast-text">--</div>
            <div style="font-size: 1.1rem; margin-top: 6px; color: #cfd8dc;">
                æœ€é«˜ <span class="high" id="today-high">--</span> / 
                æœ€ä½ <span class="low" id="today-low">--</span> <span class="unit">â„ƒ</span>
            </div>
            <div style="font-size: 0.9rem; margin-top: 10px; color: #81d4fa; font-weight: bold;">
                â˜”ï¸ é™æ°´ç¢ºç‡: æœ <span id="today-prob-am">--</span>% / æ˜¼ <span id="today-prob-pm">--</span>%
            </div>
        </div>
    </div>
    <div class="panel" style="height: 160px;">
        <div class="data-group">
            <div class="label">æ˜æ—¥ã®å¤©æ°—</div>
            <div id="tomorrow-weather" class="forecast-text">--</div>
            <div style="font-size: 1.1rem; margin-top: 6px; color: #cfd8dc;">
                æœ€é«˜ <span class="high" id="tomorrow-high">--</span> / 
                æœ€ä½ <span class="low" id="tomorrow-low">--</span> <span class="unit">â„ƒ</span>
            </div>
            <div style="font-size: 0.9rem; margin-top: 10px; color: #81d4fa; font-weight: bold;">
                â˜”ï¸ é™æ°´ç¢ºç‡: æœ <span id="tomorrow-prob-am">--</span>% / æ˜¼ <span id="tomorrow-prob-pm">--</span>%
            </div>
        </div>
    </div>
</div>

<div id="update-msg">å®å¡šå¸‚ãƒ‡ãƒ¼ã‚¿åŒæœŸå®Œäº†</div>

<script>
    let charts = {};

    function getWeatherText(code) {
        const weatherMap = {
            0: "â˜€ï¸ å¿«æ™´", 1: "ğŸŒ¤ æ™´ã‚Œ", 2: "â›…ï¸ æ›‡ã‚Š", 3: "â˜ï¸ æ›‡å¤©",
            45: "ğŸŒ« éœ§", 48: "ğŸŒ« éœ§æ°·", 51: "ğŸš¿ éœ§é›¨", 53: "ğŸš¿ éœ§é›¨", 55: "ğŸš¿ éœ§é›¨",
            61: "â˜”ï¸ å°é›¨", 63: "â˜”ï¸ é›¨", 65: "ğŸŒŠ å¤§é›¨", 71: "â„ï¸ å°é›ª", 73: "â„ï¸ é›ª", 75: "â˜ƒï¸ å¤§é›ª",
            80: "ğŸŒ¦ ã«ã‚ã‹é›¨", 81: "ğŸŒ¦ ã«ã‚ã‹é›¨", 82: "â›ˆ æ¿€ã—ã„é›¨", 95: "âš¡ï¸ é›·é›¨"
        };
        return weatherMap[code] || "ä¸æ˜";
    }

    function getWindDirection(degree) {
        const directions = ['åŒ—', 'åŒ—åŒ—æ±', 'åŒ—æ±', 'æ±åŒ—æ±', 'æ±', 'æ±å—æ±', 'å—æ±', 'å—å—æ±', 'å—', 'å—å—è¥¿', 'å—è¥¿', 'è¥¿å—åŒ—', 'è¥¿', 'è¥¿åŒ—è¥¿', 'åŒ—è¥¿', 'åŒ—åŒ—è¥¿'];
        const index = Math.round(degree / 22.5) % 16;
        return directions[index];
    }

    function initCharts(tempH, rainH, snowH, windH, pressH) {
        const commonOptions = {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
        };

        charts.tempChart = new Chart(document.getElementById('tempChart'), {
            type: 'line',
            data: { labels: Array(tempH.length).fill(''), datasets: [{ data: tempH, borderColor: '#ffab91', backgroundColor: '#ffab9122', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 }] },
            options: commonOptions
        });

        charts.rainSnowChart = new Chart(document.getElementById('rainSnowChart'), {
            type: 'line',
            data: { labels: Array(rainH.length).fill(''), datasets: [{ data: rainH, borderColor: '#81d4fa', backgroundColor: '#81d4fa33', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 }, { data: snowH, borderColor: '#ffffff', backgroundColor: '#ffffff11', fill: true, tension: 0.4, borderWidth: 1, pointRadius: 0, borderDash: [5, 5] }] },
            options: commonOptions
        });

        charts.windChart = new Chart(document.getElementById('windChart'), {
            type: 'line',
            data: { labels: Array(windH.length).fill(''), datasets: [{ data: windH, borderColor: '#a5d6a7', backgroundColor: '#a5d6a722', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 }] },
            options: commonOptions
        });

        charts.pressureChart = new Chart(document.getElementById('pressureChart'), {
            type: 'line',
            data: { labels: Array(pressH.length).fill(''), datasets: [{ data: pressH, borderColor: '#ce93d8', backgroundColor: '#ce93d822', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 }] },
            options: commonOptions
        });
    }

    async function updateData() {
        const msgEl = document.getElementById('update-msg');
        const lat = 34.80;
        const lon = 135.34;
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,precipitation,snowfall,wind_speed_10m,wind_direction_10m,weather_code,surface_pressure&hourly=temperature_2m,precipitation,snowfall,wind_speed_10m,precipitation_probability,surface_pressure&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            const cur = data.current;
            document.getElementById('temp-val').innerText = cur.temperature_2m.toFixed(1);
            document.getElementById('current-weather').innerText = getWeatherText(cur.weather_code);
            document.getElementById('rain-val').innerText = cur.precipitation.toFixed(1);
            document.getElementById('snow-val').innerText = cur.snowfall.toFixed(1);
            document.getElementById('wind-val').innerText = (cur.wind_speed_10m / 3.6).toFixed(1);
            document.getElementById('wind-dir-val').innerText = getWindDirection(cur.wind_direction_10m);
            document.getElementById('pressure-val').innerText = Math.round(cur.surface_pressure);

            const now = new Date();
            document.getElementById('today-date').innerText = now.getFullYear() + "å¹´" + (now.getMonth() + 1) + "æœˆ" + now.getDate() + "æ—¥";
            document.getElementById('time-val').innerText = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');

            const daily = data.daily;
            document.getElementById('today-weather').innerText = getWeatherText(daily.weather_code[0]);
            document.getElementById('today-high').innerText = daily.temperature_2m_max[0].toFixed(1);
            document.getElementById('today-low').innerText = daily.temperature_2m_min[0].toFixed(1);
            document.getElementById('tomorrow-weather').innerText = getWeatherText(daily.weather_code[1]);
            document.getElementById('tomorrow-high').innerText = daily.temperature_2m_max[1].toFixed(1);
            document.getElementById('tomorrow-low').innerText = daily.temperature_2m_min[1].toFixed(1);

            const probH = data.hourly.precipitation_probability;
            document.getElementById('today-prob-am').innerText = Math.max(...probH.slice(6, 12));
            document.getElementById('today-prob-pm').innerText = Math.max(...probH.slice(12, 18));
            document.getElementById('tomorrow-prob-am').innerText = Math.max(...probH.slice(30, 36));
            document.getElementById('tomorrow-prob-pm').innerText = Math.max(...probH.slice(36, 42));

            const hL = 24;
            const tempH = data.hourly.temperature_2m.slice(0, hL);
            const rainH = data.hourly.precipitation.slice(0, hL);
            const snowH = data.hourly.snowfall.slice(0, hL);
            const windH = data.hourly.wind_speed_10m.slice(0, hL).map(v => v / 3.6);
            const pressH = data.hourly.surface_pressure.slice(0, hL);

            if (!charts.tempChart) {
                initCharts(tempH, rainH, snowH, windH, pressH);
            } else {
                charts.tempChart.data.datasets[0].data = tempH;
                charts.rainSnowChart.data.datasets[0].data = rainH;
                charts.rainSnowChart.data.datasets[1].data = snowH;
                charts.windChart.data.datasets[0].data = windH;
                charts.pressureChart.data.datasets[0].data = pressH;
                Object.values(charts).forEach(c => c.update());
            }

            msgEl.innerText = "å®å¡šå¸‚ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ";
        } catch (e) {
            msgEl.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼";
            console.error(e);
        }
    }

    window.onload = () => {
        updateData();
        setInterval(updateData, 60000);
    };
</script>
</body>
</html>
